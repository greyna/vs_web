<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
	<div style="position: fixed;top: 1em;right: 1em;">
		<div style="margin:20px; margin-top:5px">
			<div style="position: fixed;right: 1em;"><input type="button" alt="Upload" style="background: url(../logoUpload.png);width:23px;height:23px;font-size:10px;margin:0px;padding:0px;" onclick="if (this.parentNode.parentNode.getElementsByTagName('div')[2].getElementsByTagName('div')[0].style.display != '') { this.parentNode.parentNode.getElementsByTagName('div')[2].getElementsByTagName('div')[0].style.display = ''; } else { this.parentNode.parentNode.getElementsByTagName('div')[2].getElementsByTagName('div')[0].style.display = 'none'; }" />
			</div>
			<div style="position: fixed;margin-top:40px;right: 1em;"><input type="button" alt="Aide" style="background: url(../question.png);width:23px;height:23px;font-size:10px;margin:0px;padding:0px;" onclick="if (this.parentNode.parentNode.getElementsByTagName('div')[5].getElementsByTagName('div')[0].style.display != '') { this.parentNode.parentNode.getElementsByTagName('div')[5].getElementsByTagName('div')[0].style.display = ''; } else { this.parentNode.parentNode.getElementsByTagName('div')[5].getElementsByTagName('div')[0].style.display = 'none'; }" />
			</div>
			<div >
				<div style="display: none;">
					<form id="upload" method="POST" enctype="multipart/form-data" action="/upload">
						<table id="fileTable"><tbody></tbody></table>
						<br />
						<input id="addFile" type="button" value="Add File" /> Press here to add an upload field.<br/>
						<input type="submit" id="submit" value="Upload"/> Press here to upload the files!
					</form>
					<br/>
					<div id="result"></div>
				</div>
			</div>
			<div >
				<div style="display: none;">
					<p><em>Ce composant permet l'upload des images sur le serveur. Vous pouvez ainsi ajouter vos images pour pouvoir les utiliser plus tard!</em></p>
				</div>
			</div>
		</div>

	</div>
</body>
<footer>
    <script src="jquery.js"></script>
    <script src="./util.js"></script>
    <script type="text/javascript">
		//Éviter les conflits entre browsers
		var jq = jQuery.noConflict();

		function addUploadField() {
			var newFileIndex = jq('#fileTable tbody').children().length;
	        jq('#fileTable tbody').append(
				'<tr>'+
					'<td>['+newFileIndex+'] Name : <input type="text" id="name'+newFileIndex+'" name="name"/><br /></td>'+
					'<td>File to upload : <input type="file" id="file'+newFileIndex+'" name="file" /></td>'+
				'</tr>');

	        jq('#file'+newFileIndex).change(function(e) {
	        	var filename = jq('#file'+newFileIndex).val().replace(/.*(\/|\\)/, '');
	        	jq('#name'+newFileIndex).val(filename);
	        });
		}

		function uploadFiles() {
			var nbFiles = jq('#fileTable tbody').children().length;
			var data = new FormData();

			for (var i = 0; i < nbFiles; i++) {
				var file = jq('#file'+i)[0].files[0];
				var name = jq('#name'+i).val();

				if (name != "" && file != undefined) {
					data.append('file', file);
					data.append('name', name);
				}
			}

			jq.ajax({
			    url: 'http://localhost:8080/upload',
			    data: data,
			    cache: false,
			    contentType: false,
			    processData: false,
			    type: 'POST',
			    success: function(msg){
					console.log("upload réussi");
					jq('#result').html(msg);
			    },
				error : function(msg) {
					console.log("upload raté");
					jq('#result').html(msg);
				}
			});
		}


		addUploadField();
		jq('#addFile').click(addUploadField);
		jq('#upload').submit(function(e) {
			e.preventDefault();
			uploadFiles();
		});
	</script>
</footer>
</html>