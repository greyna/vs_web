<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="./bootstrap/css/bootstrap.min.css" />
	<link rel="stylesheet" type="text/css" href="./bootstrap/css/bootstrap-theme.min.css" />
	<link rel="stylesheet" type="text/css" href="arborescence_css.css" />
	<link rel="stylesheet" type="text/css" href="style.css" />
</head>
<body>
	<div style="position: fixed;top: 1em;right: 1em;">
		<div class="pull-right">
			<button id="btnUpload" type="button" class="btn btn-default navbar-btn"><span class="glyphicon glyphicon-upload"></span>  Upload</button><br/>
			<button id="btnHelp" type="button" class="btn btn-default navbar-btn"><span class="glyphicon glyphicon-question-sign"></span>  Help</button>
		</div></br>
		<div style="margin:20px; margin-top:5px" class="pull-right">
			
			<div id="divUpload" class="pull-right" style="background-color: eee; width:500px;padding-left:10px;padding-top:10px;right:10px;display: none;">
				<form id="upload" method="POST" enctype="multipart/form-data" action="/upload">
					<table id="fileTable"><tbody></tbody></table>
					<br />
					<input id="addFile" type="button" value="Add File" /> Press here to add an upload field.<br/>
					<br />
					<input type="submit" id="submit" value="Upload"/> Press here to upload the files!
				</form>
				<br/>
				<div id="result"></div>
			</div>
			
			<div id="divHelp" class="pull-bottom" style="margin-top:20px;width:500px;display: none;background-color:fcf8e3;">
				<p><em>Ce composant permet l'upload des images sur le serveur. Vous pouvez ainsi ajouter vos images pour pouvoir les utiliser plus tard!</em></p>
			</div>
			
		</div>

	</div>
</body>
<footer>
    <script src="jquery.js"></script>
    <script src="./util.js"></script>
    <script type="text/javascript">
		//Éviter les conflits entre browsers
		var jq = jQuery.noConflict();
		
		var divUp = jq("#divUpload");
		var divHe = jq("#divHelp");
		//a.html("insert html here");
		var btnUp = jq("#btnUpload");
		var btnHe = jq("#btnHelp");
		btnUp.click(function(){
			if(divUp.is(":visible")){
				divUp.hide();
			} else {
				divUp.show();
			}
		});
		btnHe.click(function(){
			if(divHe.is(":visible")){
				divHe.hide();
			} else {
				divHe.show();
			}
		});

		function addUploadField() {
			var newFileIndex = jq('#fileTable tbody').children().length;
	        jq('#fileTable tbody').append(
				'<tr>'+
					'<td>['+newFileIndex+'] Name : <input type="text" id="name'+newFileIndex+'" name="name"/><br /></td>'+
					'<td>File to upload : <input type="file" id="file'+newFileIndex+'" name="file" /></td>'+
				'</tr>');

	        jq('#file'+newFileIndex).change(function(e) {
	        	var filename = jq('#file'+newFileIndex).val().replace(/.*(\/|\\)/, '');
	        	jq('#name'+newFileIndex).val(filename);
	        });
		}

		function uploadFiles() {
			var nbFiles = jq('#fileTable tbody').children().length;
			var data = new FormData();

			for (var i = 0; i < nbFiles; i++) {
				var file = jq('#file'+i)[0].files[0];
				var name = jq('#name'+i).val();

				if (name != "" && file != undefined) {
					data.append('file', file);
					data.append('name', name);
				}
			}

			jq.ajax({
			    url: vs_url + 'upload',
			    data: data,
			    cache: false,
			    contentType: false,
			    processData: false,
			    type: 'POST',
			    success: function(msg){
					console.log("upload réussi");
					jq('#result').html(msg);
			    },
				error : function(msg) {
					console.log("upload raté");
					jq('#result').html(msg);
				}
			});
		}

		addUploadField();
		jq('#addFile').click(addUploadField);
		jq('#upload').submit(function(e) {
			e.preventDefault();
			uploadFiles();
		});
	</script>
</footer>
</html>